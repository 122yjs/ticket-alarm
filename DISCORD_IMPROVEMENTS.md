# 디스코드 알림 시스템 개선사항

## 개요

이 문서는 티켓 알림 시스템의 디스코드 알림 기능에 대한 주요 개선사항을 설명합니다.

## 주요 개선사항

### 1. 메시지 가독성 향상

#### 개선된 임베드 메시지
- **우선순위 표시**: 중요한 티켓에 대해 시각적으로 구분되는 색상과 제목 사용
- **상세 정보 포함**: 공연 장소, 가격 정보 등 추가 세부사항 표시
- **이모지 활용**: 티켓 유형별 적절한 이모지로 가독성 향상
- **소스별 썸네일**: 각 티켓 소스에 맞는 썸네일 이미지 표시

#### 날짜 포맷팅
- 오픈 날짜를 한국어 형식으로 표시 (예: "2024년 1월 15일 월요일 오전 10시")
- 상대적 시간 표시 (예: "3일 후 오픈")

### 2. 중복 알림 방지

#### 해시 기반 중복 검사
- 티켓의 고유 정보(제목, 날짜, 소스)를 기반으로 SHA-256 해시 생성
- 기존 알림 기록과 비교하여 중복 전송 방지
- 30일 이상 된 알림 기록 자동 정리

#### 알림 이력 관리
- `data/notification_history.json`에 알림 전송 기록 저장
- 일일 알림 통계 추적
- 전송된 티켓의 해시값 저장으로 정확한 중복 검사

### 3. 사용자 맞춤형 키워드 필터링

#### 기본 키워드 필터링
- 설정된 키워드가 포함된 티켓만 알림 전송
- 제목과 설명 모두에서 키워드 검색
- 대소문자 구분 없는 검색

#### 우선순위 키워드
- `PRIORITY_KEYWORDS` 설정으로 중요한 키워드 지정
- 우선순위 티켓에 대해 특별한 알림 스타일 적용
- `@here` 멘션으로 즉시 알림 (온라인 사용자 대상)

### 4. 향상된 배치 처리

#### 우선순위 기반 정렬
- 우선순위 티켓을 먼저 처리
- 날짜순으로 정렬하여 체계적인 알림 전송

#### 배치 크기 제한
- 한 번에 처리할 최대 티켓 수 설정 가능
- API 속도 제한 방지를 위한 지연 시간 조절
- 우선순위 티켓 간에는 더 짧은 지연 시간 적용

#### 오류 처리 개선
- HTTP 타임아웃 설정 (10초)
- 429 오류 (Rate Limit) 발생 시 자동 재시도
- 상세한 오류 로깅 및 분류

### 5. 통계 및 모니터링

#### 알림 통계
- 일일 알림 전송 수 추적
- 총 알림 전송 수 기록
- 최근 7일간 알림 통계 제공

#### 모니터링 개선
- 모니터링 사이클별 상세 통계
- 실행 시간 추적 및 성능 모니터링
- 10사이클마다 통계 정보 자동 출력

## 설정 옵션

### config.json 새로운 설정

```json
{
  "DISCORD_WEBHOOK_URL": "https://discord.com/api/webhooks/YOUR_WEBHOOK_URL",
  "KEYWORDS": ["아이유", "BTS", "블랙핑크"],
  "PRIORITY_KEYWORDS": ["아이유", "방탄소년단"],
  "interval": 3600,
  "notification_delay": 1.0,
  "max_notifications_per_cycle": 10,
  "sources": ["interpark", "yes24", "melon", "ticketlink"]
}
```

#### 새로운 설정 항목
- `PRIORITY_KEYWORDS`: 우선순위 알림을 받을 키워드 목록
- `notification_delay`: 알림 간 지연 시간 (초, 기본값: 1.0)
- `max_notifications_per_cycle`: 한 사이클당 최대 알림 수 (기본값: 10)

## 파일 구조

### 새로 생성되는 파일
- `data/notification_history.json`: 알림 전송 이력 및 통계
- `data/sent_notifications.json`: 전송된 알림 기록 (기존 파일 개선)

### 수정된 파일
- `discord_notifier.py`: 핵심 알림 로직 대폭 개선
- `monitor.py`: 모니터링 시스템과 통계 기능 추가
- `config.json.example`: 새로운 설정 옵션 추가

## 사용법

### 기본 사용
기존과 동일하게 `python monitor.py` 명령으로 실행하면 모든 개선사항이 자동으로 적용됩니다.

### 통계 확인
모니터링 실행 중 매 10사이클마다 자동으로 통계가 출력되며, 프로그램 종료 시 최종 통계가 표시됩니다.

### 우선순위 알림 설정
1. `config.json`에서 `PRIORITY_KEYWORDS` 배열에 중요한 키워드 추가
2. 해당 키워드가 포함된 티켓은 자동으로 우선순위 처리

## 성능 개선

- **메모리 효율성**: 30일 이상 된 기록 자동 정리
- **네트워크 최적화**: 타임아웃 설정 및 재시도 로직
- **처리 속도**: 해시 기반 중복 검사로 빠른 필터링
- **안정성**: 상세한 오류 처리 및 로깅

## 호환성

이 개선사항은 기존 설정 파일과 완전히 호환되며, 새로운 설정 항목은 선택사항입니다. 기존 사용자는 별도 설정 없이도 개선된 기능을 사용할 수 있습니다.