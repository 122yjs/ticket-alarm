name: Ticket Crawler

on:
  schedule:
    # 매 시간 정각에 실행 (한국 시간 기준 오전 9시, 10시, ...)
    - cron: '0 * * * *'
  workflow_dispatch:
    # GitHub Actions 탭에서 수동으로 실행 가능하게 함

jobs:
  crawl-tickets:
    runs-on: ubuntu-latest # 가상 리눅스 환경에서 실행

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11' # 파이썬 버전 지정

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Install Playwright browsers and dependencies
      run: |
        # Playwright가 필요로 하는 브라우저와 시스템 라이브러리 설치
        npx playwright install --with-deps

    - name: Run crawler script
      run: python monitor.py
      env:
        # GitHub Secrets를 환경 변수로 스크립트에 전달
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
